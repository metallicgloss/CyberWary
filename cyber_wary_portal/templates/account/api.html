{% extends "portal.html" %}

{% load static %}

{% comment %}
GNU General Public License v3.0
Cyber Wary - <https://github.com/metallicgloss/CyberWary>
Copyright (C) 2021 - William P - <hello@metallicgloss.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
{% endcomment %}

{% block page_content %}
    <h2>CyberWary API</h2>
    <p>View and regenerate your API key, or explore your request history.</p>
    <div class="row mt-5">
        <div class="col-lg-12 col-xl-3">
            <div class="account-information">
                <h5 class="mb-4">API Details</h5>
                <p class="mb-0 fw-bold">Current API Key</p>
                <p><code><span class="fw-bold">{{ api_key.key }}</span></code></p>
                <p class="mb-0 fw-bold">Key Creation</p>
                <p><code><span class="fw-bold">{{ api_key.created|date:"l jS F Y - H:i e" }}</span></code></p>
            </div>
        </div>
        <div class="col-xl-1 d-lg-none d-xl-block">
            <div class="section-divider"></div>
        </div>
        <div class="col-lg-12 col-xl-8">
            <h5 class="mb-4">Regenerate API Key</h5>
            <form method="POST">
                {% csrf_token %}
                {{ form.non_field_errors }}
                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                <div class="row">
                    <div class="col-xl-12">
                        <p class="mb-0 fw-bold">
                            <i class="icofont-check-circled me-2"></i> {{ form.confirmation.label }}<span class="text-danger">*</span>
                        </p>
                        <p class="mb-3 text-tertiary help-text"><i>{{ form.confirmation.help_text }}</i></p>
                        <input id="toggle-on" class="form-radio-toggle toggle-left" name="{{ form.confirmation.name }}" value="false" type="radio" checked>
                        <label for="toggle-on" class="form-radio-toggle-btn">No</label>
                        <input id="toggle-off" class="form-radio-toggle toggle-right" name="{{ form.confirmation.name }}" value="true" type="radio">
                        <label for="toggle-off" class="form-radio-toggle-btn">Yes</label>
                    </div>
                </div>
                <div class="row update-button" style="display:none;">
                    <div class="col-lg-12">
                        <button class="btn bg-success text-white px-5 py-2 mt-4 text-uppercase" type="submit">Reset API Key <i class="icofont-refresh ms-3"></i></i></button>
                    </div>
                </div>
                {% if update %}
                    <div class="form-errors success-message mt-4">
                        <h5 class="text-success">Success.</h5>
                        <ul>
                            <li>Your API key has been successfully re-generated.</li>
                        </ul>
                    </div>
                {% endif %}
            </form>
        </div>
    </div>
    <div class="row mt-5 pt-5" style="border-top: 1px solid var(--light-border);">
        <div class="col-xl-12">
            <h5 class="mb-4">API Request Activity</h5>
        </div>
    </div>
{% endblock %}

{% block page_scripts %}
<script>
    $(document).ready(function(){
        $('input[type=radio][name="confirmation"]').change(function() {
            if (this.value == "true") {
                $('.update-button').show()
                $('.success-message').hide()
            }
            else {
                $('.update-button').hide()
            }
        });
    });
</script>
{% endblock%}